<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>PLANT ARCHIVE ìƒì„¸ ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; padding: 40px 20px; font-family: 'Pretendard', sans-serif; }
        .dashboard-container { max-width: 800px; margin: auto; }
        .info-card { background: white; border-radius: 15px; padding: 30px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); margin-top: 25px; border: none; }
        .row-item { display: flex; border-bottom: 1px solid #f1f3f5; padding: 12px 0; }
        .row-item:last-child { border-bottom: none; }
        .label { width: 140px; color: #6c757d; font-weight: 600; font-size: 0.9rem; flex-shrink: 0; }
        .value { color: #2d3436; font-weight: 500; font-size: 1.05rem; word-break: break-all; }
        .status-badge { display: inline-block; padding: 5px 15px; border-radius: 50px; font-weight: 700; font-size: 0.85rem; margin-bottom: 15px; }
        .status-Shutdown { background-color: #ffe3e3; color: #e03131; }
        .status-Run-Cut { background-color: #fff4e6; color: #fd7e14; }
        .comment-section { background: #f8f9fa; border-radius: 10px; padding: 15px; margin-top: 10px; border-left: 4px solid #dee2e6; }
    </style>
</head>
<body>

<div class="dashboard-container">
    <h3 class="text-center fw-bold text-dark mb-4">ğŸ“‘ PLANT ARCHIVE STATUS</h3>
    
    <div class="card p-3 border-0 shadow-sm mb-4">
        <div class="row g-2">
            <div class="col-md-6">
                <select id="pSelect" class="form-select" onchange="updateComp()"><option value="">í’ˆëª©(Product) ì„ íƒ</option></select>
            </div>
            <div class="col-md-6">
                <select id="cSelect" class="form-select" onchange="render()" disabled><option value="">ì—…ì²´(Company) ì„ íƒ</option></select>
            </div>
        </div>
    </div>

    <div id="displayArea">
        <p class="text-center text-muted py-5">í’ˆëª©ê³¼ ì—…ì²´ë¥¼ ì„ íƒí•˜ë©´ ìƒì„¸ ì •ë³´ê°€ ì„¸ë¡œë¡œ ë‚˜íƒ€ë‚©ë‹ˆë‹¤.</p>
    </div>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxJuVq47aFzMgcvM_mBG1x7JFfoKZrz7xIZ-T0rm3hcLkD4Hoxf3ML36m2-9ACus_p4VQ/exec";
    let db = [];

    async function init() {
        const res = await fetch(GAS_URL);
        const data = await res.json();
        db = data.slice(1); // í—¤ë” ì œì™¸
        const prods = [...new Set(db.map(x => x[3]))].filter(x => x && x !== "-");
        prods.forEach(p => document.getElementById('pSelect').innerHTML += `<option value="${p}">${p}</option>`);
    }

    function updateComp() {
        const p = document.getElementById('pSelect').value;
        const cs = document.getElementById('cSelect');
        cs.innerHTML = '<option value="">ì—…ì²´(Company) ì„ íƒ</option>';
        if(!p) { cs.disabled = true; return; }
        const comps = [...new Set(db.filter(x => x[3] === p).map(x => x[1]))];
        comps.forEach(c => cs.innerHTML += `<option value="${c}">${c}</option>`);
        cs.disabled = false;
        document.getElementById('displayArea').innerHTML = "";
    }

    function render() {
        const p = document.getElementById('pSelect').value;
        const c = document.getElementById('cSelect').value;
        const area = document.getElementById('displayArea');
        const rows = db.filter(x => x[3] === p && x[1] === c).reverse(); // ìµœì‹  ë°ì´í„° ìš°ì„ 

        if(rows.length > 0) {
            area.innerHTML = rows.map(item => {
                const sType = item[5].replace(" ", "-");
                return `
                    <div class="info-card">
                        <span class="status-badge status-${sType}">${item[5]}</span>
                        <div class="row-item"><div class="label">ë‚ ì§œ(ì…ë ¥ì¼)</div><div class="value">${new Date(item[0]).toLocaleString()}</div></div>
                        <div class="row-item"><div class="label">ì—…ì²´ëª…</div><div class="value"><strong>${item[1]}</strong></div></div>
                        <div class="row-item"><div class="label">ì§€ì—­</div><div class="value">${item[2]}</div></div>
                        <div class="row-item"><div class="label">í’ˆëª©</div><div class="value">${item[3]}</div></div>
                        <div class="row-item"><div class="label">ì¼€íŒŒ(Capacity)</div><div class="value text-primary fw-bold">${item[4]}</div></div>
                        <div class="row-item"><div class="label">ìƒíƒœ(ì‹±í…Œ)</div><div class="value">${item[5]}</div></div>
                        <div class="row-item"><div class="label">ì´ë²¤íŠ¸ ê¸°ê°„</div><div class="value">${item[6]}</div></div>
                        <div class="row-item"><div class="label">ì‚¬ìœ (Reason)</div><div class="value">${item[7]}</div></div>
                        <div class="row-item" style="border-bottom:none;">
                            <div class="label">ì½”ë©˜íŠ¸</div>
                            <div class="value w-100">
                                <div class="comment-section">${item[8]}</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }
    }
    init();
</script>
</body>
</html>
