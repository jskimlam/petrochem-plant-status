<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>í”ŒëœíŠ¸ ì •ë³´ ëŒ€ì‹œë³´ë“œ</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding: 30px; }
        .container { max-width: 1000px; background: white; padding: 30px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .info-table th { width: 30%; background-color: #f1f3f5; }
        .status-badge { padding: 5px 12px; border-radius: 20px; font-weight: bold; }
        .Shutdown { background-color: #ffdee2; color: #d63031; }
        .Run-Cut { background-color: #fff4e6; color: #fd7e14; }
    </style>
</head>
<body>
<div class="container">
    <h3 class="text-center mb-4">ğŸ“‘ PLANT ARCHIVE STATUS</h3>
    
    <div class="row g-3 mb-4">
        <div class="col-md-6">
            <label class="form-label fw-bold">1. í’ˆëª© ì„ íƒ</label>
            <select id="pSelect" class="form-select" onchange="updateComp()"><option value="">í’ˆëª© ì„ íƒ</option></select>
        </div>
        <div class="col-md-6">
            <label class="form-label fw-bold">2. ì—…ì²´ ì„ íƒ</label>
            <select id="cSelect" class="form-select" onchange="render()" disabled><option value="">ì—…ì²´ ì„ íƒ</option></select>
        </div>
    </div>

    <div id="resultArea"></div>
</div>

<script>
    const GAS_URL = "https://script.google.com/macros/s/AKfycbxsSY65cTM0BqHC8InuuwFyvb6OsCNtzHBSNo-zvWqi0pD6XxI_qG-ZPi8HXwg2GQrEIw/exec";
    let dataList = [];

    async function init() {
        const res = await fetch(GAS_URL);
        const data = await res.json();
        dataList = data.slice(1); // í—¤ë” ì œì™¸
        const prods = [...new Set(dataList.map(x => x[3]))].filter(x => x && x !== "-");
        prods.forEach(p => document.getElementById('pSelect').innerHTML += `<option value="${p}">${p}</option>`);
    }

    function updateComp() {
        const p = document.getElementById('pSelect').value;
        const cs = document.getElementById('cSelect');
        cs.innerHTML = '<option value="">ì—…ì²´ ì„ íƒ</option>';
        if(!p) { cs.disabled = true; return; }
        const comps = [...new Set(dataList.filter(x => x[3] === p).map(x => x[1]))];
        comps.forEach(c => cs.innerHTML += `<option value="${c}">${c}</option>`);
        cs.disabled = false;
        document.getElementById('resultArea').innerHTML = "";
    }

    function render() {
        const p = document.getElementById('pSelect').value;
        const c = document.getElementById('cSelect').value;
        const area = document.getElementById('resultArea');
        const item = [...dataList].reverse().find(x => x[3] === p && x[1] === c); // ìµœì‹  ë°ì´í„°

        if(item) {
            area.innerHTML = `
                <div class="table-responsive">
                    <table class="table table-bordered info-table">
                        <tr><th>ì…ë ¥ì¼</th><td>${new Date(item[0]).toLocaleString()}</td></tr>
                        <tr><th>ì—…ì²´ëª…</th><td><strong>${item[1]}</strong></td></tr>
                        <tr><th>ì§€ì—­</th><td>${item[2]}</td></tr>
                        <tr><th>í’ˆëª©</th><td>${item[3]}</td></tr>
                        <tr><th>ì¼€íŒŒ (Capacity)</th><td><span class="text-primary fw-bold">${item[4]}</span></td></tr>
                        <tr><th>ìƒíƒœ (ì‹±í…Œ)</th><td><span class="status-badge ${item[5].replace(" ", "-")}">${item[5]}</span></td></tr>
                        <tr><th>ì´ë²¤íŠ¸ ê¸°ê°„</th><td>${item[6]}</td></tr>
                        <tr><th>ì‚¬ìœ  (Reason)</th><td>${item[7]}</td></tr>
                        <tr><th>ì½”ë©˜íŠ¸ (Comments)</th><td class="bg-light"><em>${item[8]}</em></td></tr>
                    </table>
                </div>
            `;
        }
    }
    init();
</script>
</body>
</html>
